{% extends "base_template.html" %}

{% block content %}
    <div style="display:flex; align-items:center; height: calc(100vh - 90px); width: 100%;">
        <div style="height: 100%; width: 40%;">
            {% load custom_filters %}
            <div style="display: flex; flex-direction: column; align-items: center; height: 100%; width: 100%; border-left: 1px solid black; border-right: 1px solid black;">
                <div class="centered" style="position: relative; width: 100%; height: calc(100vh - 68px - 94px - 465px); padding-top: 20px;">
                    <img src="{{ current_computer.case.image.url }}" style="max-width: 80%; max-height: 100%; padding: 10px;">
                    {% if current_computer.valid %}
                        <form method="GET" action="{% url 'assembly_analysis' %}" style="position: absolute; top: 10px; left: 10px; width: 60px; height: 60px;">
                            {% csrf_token %}
                            <input type="submit" value="" class="analysis_button">
                        </form>
                    {% endif %}
                    <form method="GET" action="{% url 'assemble' %}" style="position: absolute; top: 10px; right: 10px; width: 60px; height: 60px;">
                        {% csrf_token %}
                        <input type="submit" value="" class="configure_button" style="position: static;">
                    </form>
                </div>
                <div style="width: 100%; height: 68px; display: flex; flex-direction: column; justify-content: space-around; align-items: center; margin-top: 10px; margin-bottom: 16px;">
                    <div class="centered" style="width: 100%; height: 60%; font-size: 22px; padding-bottom: 10px; text-align: center;">
                        {{ current_computer.name }}
                    </div>
                    <div class="centered" style="width: 80%; height: 40%; font-size: 15px; border-top: 1px solid black; padding-top: 16px; text-align: center;">
                        {% if current_computer.price is not None %}
                            <div>{{current_computer.price}} руб.</div>
                        {% else %}
                            <div>---</div>
                        {% endif %}
                    </div>
                </div>
                <div style="width: 100%; height: 465px;">
                    <div style="display: flex; flex-direction: column; justify-content: space-evenly; align-items: center; width: calc(100% - 20px); height: calc(100% - 20px); padding-left: 9.2%;">
                        {% if current_computer.processor is not None %}
                            <div style="width: 100%; height: 82px; display: flex; flex-direction: column; padding: 3px;">
                                <div style="font-size: 14pt;">Процессор</div>
                                    <div style="padding-left: 20px;">{{ current_computer.processor.manufacturer.name }} {{ current_computer.processor.series }} {{ current_computer.processor.model }}</div>
                                    <div style="padding-left: 20px;">{{ current_computer.processor.cores }} ядер / {{ current_computer.processor.threads }} потоков / {{ current_computer.processor.frequency }} МГц</div>
                            </div>
                        {% else %}
                            <div style="width: 100%; height: 58px; display: flex; flex-direction: column; padding: 3px;">
                                <div style="font-size: 14pt;">Процессор</div>                                
                                <div style="padding-left: 20px;">Не выбран</div>
                            </div>
                        {% endif %}
                        <div style="width: 100%; height: 58px; display: flex; flex-direction: column; padding: 3px;">
                            <div style="font-size: 14pt;">Материнская плата</div>
                            {% if current_computer.motherboard is not None %}
                                <div style="padding-left: 20px;">{{ current_computer.motherboard.manufacturer.name }} {{ current_computer.motherboard.model }}</div>
                            {% else %}
                                <div style="padding-left: 20px;">Не выбрана</div>
                            {% endif %}
                        </div>
                        {% if current_computer.videocard is not None %}
                            <div style="width: 100%; height: 82px; display: flex; flex-direction: column; padding: 3px;">
                                <div style="font-size: 14pt;">Видеокарта</div>
                                <div style="padding-left: 20px;">{{ current_computer.videocard.chip_manufacturer.name }} {{ current_computer.videocard.chip }}</div>
                                <div style="padding-left: 20px;">{{ current_computer.videocard.mem_volume }} Гб {{ current_computer.videocard.mem_type }}</div>                               
                            </div>
                        {% else %}
                            <div style="width: 100%; height: 58px; display: flex; flex-direction: column; padding: 3px;">
                                <div style="font-size: 14pt;">Видеокарта</div>
                                <div style="padding-left: 20px;">Не выбрана</div>
                            </div>
                        {% endif %}
                        <div style="width: 100%; height: 58px; display: flex; flex-direction: column; padding: 3px;">
                            <div style="font-size: 14pt;">Оперативная память</div>
                            {% if current_computer.memory is not None and current_computer.memory_cnt is not None %}
                                {% load custom_filters %}
                                <div style="padding-left: 20px;">{{ current_computer.memory.volume|mult:current_computer.memory_cnt }} Гб {{ current_computer.memory.mem_type }} {{ current_computer.memory.frequency }} МГц</div>
                            {% else %}
                                <div style="padding-left: 20px;">Не выбрана</div>
                            {% endif %}
                        </div>
                        <div style="width: 100%; height: 58px; display: flex; flex-direction: column; padding: 3px;">
                            <div style="font-size: 14pt;">Блок питания</div>
                            {% if current_computer.powersupply is not None %}
                                <div style="padding-left: 20px;">{{ current_computer.powersupply.power }} Вт {{ current_computer.powersupply.certificate.name }}</div>
                            {% else %}
                                <div style="padding-left: 20px;">Не выбран</div>
                            {% endif %}
                        </div>
                        <div style="width: 100%; height: 58px; display: flex; flex-direction: column; padding: 3px;">
                            <div style="font-size: 14pt;">Корпус</div>
                            {% if current_computer.case is not None %}
                                <div style="padding-left: 20px;">{{ current_computer.case.typesize }} ({{ current_computer.case.width }}*{{ current_computer.case.height }}*{{ current_computer.case.length }}мм)</div>
                            {% else %}
                                <div style="padding-left: 20px;">Не выбран</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="height: 100%; width: 60%;">
            {% load guest_user %}
            {% if user|is_guest_user %}
                <div class="top_bar" id='guest_user_bar'>
                    Вы вошли как гость. Для сохранения сборок необходимо<span>&nbsp;</span><a href="{% url "guest_to_user" %}"> зарегистрироваться</a>.
                </div>
            {% endif %}
            <div style="display: grid; grid-template-columns: calc(100% / 24 * 11) repeat(2, calc(100% / 24 * 3)) calc(100% / 24 * 2) calc(100% / 24 * 3) calc(100% / 24 * 2); grid-auto-rows: 80px; height: 100%; width: 100%;">
                {% for computer in all_computers %}
                    <div class='centered'>{{computer.name}}</div>
                    {% if computer.temporary %}
                        <div class='centered'><div class="status_temporary"></div></div>
                    {% elif not computer.valid %}
                        <div class='centered'><div class="status_incorrect"></div></div>
                    {% else %}
                        <div class='centered'>{{computer.price}} ₽</div>
                    {% endif %}
                    <div class='centered'>{{computer.modified}}</div>
                    {% if computer.public %}
                        <div class='centered'><input style="width: 20px; height: 20px;" type="checkbox" disabled checked></div>
                    {% else %}
                        <div class='centered'><input style="width: 20px; height: 20px;" type="checkbox" disabled></div>
                    {% endif %}
                    <div class='centered'>
                        <form method="POST" action="{% url 'activate_assembly' %}">
                            {% csrf_token %}
                            <input type="hidden" name="id" value="{{ computer.id }}">
                            <input type="submit" value="Выбрать">
                        </form>
                    </div>
                    <form method="POST" action="{% url 'delete_assembly' %}" class="centered">
                        {% csrf_token %}
                        <input type="hidden" name="id" value="{{ computer.id }}">
                        <input type="submit" class="delete_button" value="">
                    </form>
                {% endfor%}
            </div>
        </div>
    </div>
{% endblock %}